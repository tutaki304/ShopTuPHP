================================================================
                    BÃO CÃO THUYáº¾T TRÃŒNH Dá»° ÃN SHOPTUPHP
         Há»† THá»NG THÆ¯Æ NG Máº I ÄIá»†N Tá»¬ HOÃ€N CHá»ˆNH
================================================================

ğŸ¯ Tá»”NG QUAN Dá»° ÃN
==================

ğŸ“Œ TÃªn dá»± Ã¡n: ShopTuPHP E-commerce System
ğŸ“Œ Má»¥c tiÃªu: PhÃ¡t triá»ƒn há»‡ thá»‘ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ hoÃ n chá»‰nh
ğŸ“Œ Kiáº¿n trÃºc: MVC (Model-View-Controller) vá»›i Native PHP
ğŸ“Œ CÆ¡ sá»Ÿ dá»¯ liá»‡u: MySQL vá»›i PDO
ğŸ“Œ TÃ­nh nÄƒng chÃ­nh: BÃ¡n hÃ ng online, quáº£n trá»‹ viÃªn, giá» hÃ ng, quáº£n lÃ½ kho

================================================================

ğŸ—ï¸ KIáº¾N TRÃšC Há»† THá»NG
======================

1. KIáº¾N TRÃšC MVC
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                    ğŸŒ VIEW LAYER                        â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚  â”‚   Frontend UI   â”‚    â”‚     Admin Dashboard         â”‚ â”‚
   â”‚  â”‚  (User Pages)   â”‚    â”‚    (Management Panel)      â”‚ â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                 ğŸ® CONTROLLER LAYER                     â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚  â”‚    Page     â”‚  â”‚   Product   â”‚  â”‚      User       â”‚ â”‚
   â”‚  â”‚ Controller  â”‚  â”‚ Controller  â”‚  â”‚   Controller    â”‚ â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                  ğŸ’¾ MODEL LAYER                         â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚  â”‚  Products   â”‚  â”‚    User     â”‚  â”‚      Cart       â”‚ â”‚
   â”‚  â”‚    Model    â”‚  â”‚    Model    â”‚  â”‚     Model       â”‚ â”‚
   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                  ğŸ—„ï¸ DATABASE LAYER                      â”‚
   â”‚                    MySQL Database                       â”‚
   â”‚     (sanpham, danhmuc, taikhoan, hoadon, etc.)         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================

ğŸ“ Cáº¤U TRÃšC Dá»° ÃN CHI TIáº¾T
===========================

ShopTuPHP/
â”œâ”€â”€ ğŸ“„ index.php                 # Entry point giao diá»‡n ngÆ°á»i dÃ¹ng
â”œâ”€â”€ ğŸ“„ admin.php                 # Entry point giao diá»‡n admin
â”œâ”€â”€ ğŸ“„ global.php               # Cáº¥u hÃ¬nh toÃ n cá»¥c
â”œâ”€â”€ ğŸ“„ shoptu.sql               # Database schema
â”‚
â”œâ”€â”€ ğŸ“ controller/              # ğŸ® Controllers (Business Logic)
â”‚   â”œâ”€â”€ ğŸ“„ page.php            # Page routing & trang chung
â”‚   â”œâ”€â”€ ğŸ“„ product.php         # Quáº£n lÃ½ sáº£n pháº©m & danh má»¥c
â”‚   â”œâ”€â”€ ğŸ“„ user.php            # XÃ¡c thá»±c & quáº£n lÃ½ user
â”‚   â””â”€â”€ ğŸ“„ order.php           # Quáº£n lÃ½ Ä‘Æ¡n hÃ ng (NEW)
â”‚
â”œâ”€â”€ ğŸ“ model/                   # ğŸ’¾ Models (Data Layer)
â”‚   â”œâ”€â”€ ğŸ“„ connect.php         # Káº¿t ná»‘i PDO Database
â”‚   â”œâ”€â”€ ğŸ“„ products.php        # CRUD sáº£n pháº©m
â”‚   â”œâ”€â”€ ğŸ“„ categories.php      # Quáº£n lÃ½ danh má»¥c
â”‚   â”œâ”€â”€ ğŸ“„ user.php            # Authentication & user data
â”‚   â”œâ”€â”€ ğŸ“„ cart.php            # Logic giá» hÃ ng
â”‚   â”œâ”€â”€ ğŸ“„ binhluan.php        # Há»‡ thá»‘ng bÃ¬nh luáº­n
â”‚   â””â”€â”€ ğŸ“„ orders.php          # Xá»­ lÃ½ Ä‘Æ¡n hÃ ng (NEW)
â”‚
â”œâ”€â”€ ğŸ“ view/                    # ğŸ–¼ï¸ Views (Presentation)
â”‚   â”œâ”€â”€ ğŸ“„ template_*.php      # Layout templates
â”‚   â”œâ”€â”€ ğŸ“„ page_*.php          # Trang ngÆ°á»i dÃ¹ng
â”‚   â””â”€â”€ ğŸ“„ product_*.php       # Trang admin
â”‚
â”œâ”€â”€ ğŸ“ assets_user/            # ğŸ¨ Frontend Assets
â”‚   â”œâ”€â”€ ğŸ“ css/               # CSS cho user
â”‚   â”œâ”€â”€ ğŸ“ img/               # HÃ¬nh áº£nh giao diá»‡n
â”‚   â””â”€â”€ ğŸ“ js/                # JavaScript
â”‚
â”œâ”€â”€ ğŸ“ assets_admin/           # ğŸ›ï¸ Admin Assets
â”‚   â”œâ”€â”€ ğŸ“ css/               # CSS cho admin
â”‚   â””â”€â”€ ğŸ“ img/               # HÃ¬nh áº£nh admin
â”‚
â””â”€â”€ ğŸ“ upload/                 # ğŸ“¤ File Upload
    â”œâ”€â”€ ğŸ“ product/           # HÃ¬nh sáº£n pháº©m
    â””â”€â”€ ğŸ“ avatar/            # Avatar user

================================================================

ğŸ”§ PHÃ‚N TÃCH CODE CHI TIáº¾T
==========================

1. ğŸš€ ENTRY POINTS
   
   ğŸ“„ index.php:
   ```php
   <?php
   session_start();
   include_once 'global.php';
   
   // Routing system vá»›i GET parameters
   if (isset($_GET['mod'])) {
       switch ($_GET['mod']) {
           case 'page':     include_once 'controller/page.php'; break;
           case 'user':     include_once 'controller/user.php'; break;
           case 'product':  include_once 'controller/product.php'; break;
           default:         header("Location: ?mod=page&act=home"); break;
       }
   }
   ?>
   ```
   
   ğŸ“„ admin.php:
   ```php
   <?php
   session_start();
   
   // Admin routing vá»›i báº£o máº­t
   if (isset($_GET['mod'])) {
       switch ($_GET['mod']) {
           case 'page':     include_once 'controller/page.php'; break;
           case 'user':     include_once 'controller/user.php'; break;
           case 'product':  include_once 'controller/product.php'; break;
           case 'order':    include_once 'controller/order.php'; break;
           default:         break;
       }
   } else {
       header("Location: admin.php?mod=page&act=dashboard");
   }
   ?>
   ```

2. ğŸ’¾ DATABASE CONNECTION (model/connect.php)
   
   ```php
   <?php
   // PDO Connection vá»›i error handling
   function pdo_get_connection(){
       $dburl = "mysql:host=localhost; dbname=shoptu;charset=utf8";
       $username = 'root';
       $password = '';
       
       $conn = new PDO($dburl, $username, $password);
       $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
       return $conn;
   }
   
   // Execute function vá»›i prepared statements
   function pdo_execute($sql){
       $sql_args = array_slice(func_get_args(), 1);
       try{
           $conn = pdo_get_connection();
           $stmt = $conn->prepare($sql);
           $stmt->execute($sql_args);
       } catch(PDOException $e){
           throw $e;
       } finally{
           unset($conn);
       }
   }
   
   // Query function tráº£ vá» máº£ng káº¿t quáº£
   function pdo_query($sql){
       $sql_args = array_slice(func_get_args(), 1);
       try{
           $conn = pdo_get_connection();
           $stmt = $conn->prepare($sql);
           $stmt->execute($sql_args);
           $rows = $stmt->fetchAll();
           return $rows;
       } catch(PDOException $e){
           throw $e;
       } finally{
           unset($conn);
       }
   }
   ?>
   ```

3. ğŸ›ï¸ PRODUCT MODEL (model/products.php)
   
   ```php
   <?php
   // Láº¥y táº¥t cáº£ sáº£n pháº©m vá»›i JOIN danh má»¥c
   function get_products($madm=0,$start=0,$limit=0){
       $sql = "SELECT s.*, d.tendm FROM sanpham s 
               INNER JOIN danhmuc d ON s.madm = d.madm";
       
       // Filter theo danh má»¥c
       if($madm!=0){
           $sql .= " WHERE s.madm=".$madm;
       }
       
       // Pagination
       if ($limit!=0) {
           $sql .= " LIMIT ".$start.",".$limit;
       }
       
       $conn = pdo_get_connection();
       $stmt = $conn->prepare($sql);
       $stmt->execute();
       return $stmt->fetchAll();
   }
   
   // ThÃªm sáº£n pháº©m vá»›i inventory tracking
   function add_product($tensp,$dongia,$khuyenmai,$soluong,$mota,$anh,$madm){
       $sql = "INSERT INTO sanpham 
               (`tensp`,`dongia`,`khuyenmai`,`soluong`,`mota`,`anh`,`madm`) 
               VALUES (:tensp, :dongia, :khuyenmai, :soluong, :mota, :anh, :madm)";
       
       $conn = pdo_get_connection();
       $stmt = $conn->prepare($sql);
       $stmt->bindParam(":tensp", $tensp);
       $stmt->bindParam(":dongia", $dongia);
       $stmt->bindParam(":khuyenmai", $khuyenmai);
       $stmt->bindParam(":soluong", $soluong);
       $stmt->bindParam(":mota", $mota);
       $stmt->bindParam(":anh", $anh);
       $stmt->bindParam(":madm", $madm);
       return $stmt->execute();
   }
   
   // Cáº­p nháº­t sá»‘ lÆ°á»£ng tá»“n kho (INVENTORY MANAGEMENT)
   function update_product_quantity($masp, $quantity_change, $reason = '') {
       try {
           $conn = pdo_get_connection();
           $conn->beginTransaction();
           
           // Láº¥y sá»‘ lÆ°á»£ng hiá»‡n táº¡i
           $current = pdo_query_one("SELECT soluong FROM sanpham WHERE masp = ?", $masp);
           $new_quantity = $current['soluong'] + $quantity_change;
           
           // Kiá»ƒm tra sá»‘ lÆ°á»£ng khÃ´ng Ã¢m
           if ($new_quantity < 0) {
               throw new Exception("Sá»‘ lÆ°á»£ng khÃ´ng Ä‘á»§");
           }
           
           // Cáº­p nháº­t sá»‘ lÆ°á»£ng
           pdo_execute("UPDATE sanpham SET soluong = ? WHERE masp = ?", 
                      $new_quantity, $masp);
           
           // Ghi log thay Ä‘á»•i
           pdo_execute("INSERT INTO stock_log (masp, quantity_change, reason) 
                       VALUES (?, ?, ?)", $masp, $quantity_change, $reason);
           
           $conn->commit();
           return true;
       } catch (Exception $e) {
           $conn->rollback();
           throw $e;
       }
   }
   ?>
   ```

4. ğŸ‘¤ USER AUTHENTICATION (model/user.php)
   
   ```php
   <?php
   // Login function vá»›i security
   function login($email,$password){
       $sql = "SELECT * FROM taikhoan WHERE email=? AND matkhau=?";
       $conn = pdo_get_connection();
       $stmt = $conn->prepare($sql);
       $stmt->execute([$email, $password]);
       return $stmt->fetch();
   }
   
   // Signup vá»›i validation
   function signup($hoten,$email,$matkhau){
       $sql = "INSERT INTO taikhoan(`hoten`,`email`,`matkhau`) 
               VALUES (?,?,?)";
       $conn = pdo_get_connection();
       $stmt = $conn->prepare($sql);
       return $stmt->execute([$hoten, $email, $matkhau]);
   }
   
   // Check email tá»“n táº¡i
   function checkMail($email){
       $sql = "SELECT * FROM taikhoan WHERE email=?";
       $conn = pdo_get_connection();
       $stmt = $conn->prepare($sql);
       $stmt->execute([$email]);
       return $stmt->fetch();
   }
   ?>
   ```

5. ğŸ›’ SHOPPING CART (model/cart.php)
   
   ```php
   <?php
   // Kiá»ƒm tra giá» hÃ ng tá»“n táº¡i
   function get_hasCart($makh){
       return pdo_query_one("SELECT * FROM hoadon WHERE makh=? AND trangthai=?",
                           $makh, 'gio-hang');
   }
   
   // ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng
   function get_addToCart($mahd, $masp, $soluong = 1){
       // Kiá»ƒm tra sáº£n pháº©m Ä‘Ã£ cÃ³ trong giá»
       $existing = pdo_query_one("SELECT * FROM chitiethoadon 
                                 WHERE mahd=? AND masp=?", $mahd, $masp);
       
       if($existing) {
           // Cáº­p nháº­t sá»‘ lÆ°á»£ng
           $newQuantity = $existing['soluong'] + 1;
           pdo_execute("UPDATE chitiethoadon SET soluong=? 
                       WHERE mahd=? AND masp=?", $newQuantity, $mahd, $masp);
       } else {
           // ThÃªm má»›i
           pdo_execute("INSERT INTO chitiethoadon(`mahd`,`masp`,`soluong`) 
                       VALUES(?,?,?)", $mahd, $masp, 1);
       }
   }
   
   // Hiá»ƒn thá»‹ chi tiáº¿t giá» hÃ ng
   function get_Cart($makh){
       return pdo_query("SELECT hd.mahd, ct.soluong, sp.masp, sp.tensp, 
                        sp.anh, sp.dongia, sp.khuyenmai 
                        FROM hoadon hd 
                        INNER JOIN chitiethoadon ct ON hd.mahd = ct.mahd 
                        INNER JOIN sanpham sp ON ct.masp = sp.masp 
                        WHERE hd.makh=? AND hd.trangthai=?
                        GROUP BY ct.masp", $makh, 'gio-hang');
   }
   ?>
   ```

================================================================

ğŸ® CONTROLLERS ANALYSIS
========================

1. ğŸ“„ PAGE CONTROLLER (controller/page.php)
   
   Chá»©c nÄƒng: Xá»­ lÃ½ cÃ¡c trang tÄ©nh vÃ  routing chÃ­nh
   
   ```php
   <?php
   include_once 'model/connect.php';
   
   $act = isset($_GET['act']) ? $_GET['act'] : '';
   
   // Load templates cho user pages
   $admin_pages = ['dashboard', 'admin_binhluan'];
   if (!in_array($act, $admin_pages)) {
       include_once 'view/template_head.php';
       include_once 'view/template_header.php';
   }
   
   switch ($act) {
       case 'home':
           include_once 'model/products.php';
           include_once 'model/categories.php';
           $data['dssp'] = get_products();
           $dsNew = get_productNew(4);
           $dsView = get_productView(4);
           include_once 'view/page_home.php';
           break;
           
       case 'giohang':
           include_once 'model/cart.php';
           include_once 'model/products.php';
           
           if (isset($_SESSION['user'])) {
               $makh = $_SESSION['user']['makh'];
               $giohang = get_hasCart($makh);
               $ctgiohang = $giohang ? get_Cart($makh) : [];
           }
           include_once 'view/page_giohang.php';
           break;
           
       case 'dashboard':
           // Admin dashboard vá»›i kiá»ƒm tra quyá»n
           if (!(isset($_SESSION['user']) && $_SESSION['user']['quyen']=='admin')) {
               header('Location: index.php');
           }
           include_once 'view/page_dashboard.php';
           break;
   }
   ?>
   ```

2. ğŸ›ï¸ PRODUCT CONTROLLER (controller/product.php)
   
   Chá»©c nÄƒng: Quáº£n lÃ½ sáº£n pháº©m, danh má»¥c, tÃ¬m kiáº¿m
   
   ```php
   <?php
   $act = isset($_GET['act']) ? $_GET['act'] : '';
   
   switch ($act) {
       case 'sanpham':
           // Pagination cho trang sáº£n pháº©m
           include_once 'model/products.php';
           include_once 'model/categories.php';
           
           $page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
           $limit = 8;
           $offset = ($page - 1) * $limit;
           
           $data['dsdm'] = get_categories();
           $all_products = get_products();
           $total_products = count($all_products);
           $dssanpham = array_slice($all_products, $offset, $limit);
           
           // TÃ­nh pagination
           $total_pages = ceil($total_products / $limit);
           $data['pagination'] = [
               'current_page' => $page,
               'total_pages' => $total_pages,
               'total_products' => $total_products
           ];
           
           include_once 'view/page_sanpham.php';
           break;
           
       case 'addToCart':
           // ThÃªm vÃ o giá» hÃ ng vá»›i AJAX
           if (isset($_SESSION['user'])) {
               include_once 'model/cart.php';
               $makh = $_SESSION['user']['makh'];
               $masp = $_POST['masp'];
               
               // Kiá»ƒm tra/táº¡o giá» hÃ ng
               $giohang = get_hasCart($makh);
               if (!$giohang) {
                   get_cartAdd($makh);
                   $giohang = get_hasCart($makh);
               }
               
               // ThÃªm sáº£n pháº©m
               get_addToCart($giohang['mahd'], $masp, 1);
               
               echo json_encode(['status' => 'success']);
           }
           exit;
           break;
           
       case 'admin':
           // Quáº£n lÃ½ sáº£n pháº©m cho admin
           if (!(isset($_SESSION['user']) && $_SESSION['user']['quyen']=='admin')) {
               header('Location: index.php');
           }
           
           include_once 'model/products.php';
           $page = isset($_GET['page']) ? $_GET['page'] : 1;
           $data['dssp'] = get_products(0, ($page-1)*4, 4);
           
           include_once 'view/product_admin.php';
           break;
   }
   ?>
   ```

3. ğŸ‘¤ USER CONTROLLER (controller/user.php)
   
   Chá»©c nÄƒng: Authentication, profile management
   
   ```php
   <?php
   include_once 'model/connect.php';
   $act = isset($_GET['act']) ? $_GET['act'] : '';
   
   switch ($act) {
       case 'login':
           include_once 'model/user.php';
           
           if(isset($_POST['submit-login'])){
               $kq = login($_POST['email'], $_POST['matkhau']);
               if($kq){
                   $_SESSION['user'] = $kq;
                   
                   // Redirect dá»±a trÃªn quyá»n
                   if($kq['quyen']=='admin'){
                       header("Location: admin.php");
                   } else {
                       header("Location: index.php"); 
                   }
               } else {
                   $thongbao = "TÃ i khoáº£n hoáº·c máº­t kháº©u chÆ°a Ä‘Ãºng!";
               }
           }
           
           include_once 'view/page_login.php';
           break;
           
       case 'signup':
           include_once 'model/user.php';
           
           if(isset($_POST['submit-signup'])){
               // Kiá»ƒm tra email tá»“n táº¡i
               $kq = checkMail($_POST['email']);
               if ($kq) {
                   $thongbao2 = "Email Ä‘Ã£ tá»“n táº¡i!";
               } else {
                   $kq = signup($_POST['hoten'], $_POST['email'], $_POST['matkhau']);
                   if($kq){
                       header("Location: ?mod=user&act=login");    
                   }
               }
           }
           
           include_once 'view/page_signup.php';
           break;
           
       case 'logout':
           session_destroy();
           header("Location: index.php");
           break;
   }
   ?>
   ```

================================================================

ğŸ—„ï¸ DATABASE SCHEMA
===================

Há»‡ thá»‘ng sá»­ dá»¥ng 7 báº£ng chÃ­nh:

1. ğŸ“Š Báº¢NG Sáº¢N PHáº¨M (sanpham)
   ```sql
   CREATE TABLE sanpham (
       masp INT PRIMARY KEY AUTO_INCREMENT,
       tensp VARCHAR(255) NOT NULL,
       dongia DECIMAL(10,3) NOT NULL,
       khuyenmai DECIMAL(10,3) DEFAULT 0,
       soluong INT DEFAULT 0,           -- âœ¨ Inventory tracking
       mota TEXT,
       anh VARCHAR(255),
       madm INT,
       soluotxem INT DEFAULT 0,
       FOREIGN KEY (madm) REFERENCES danhmuc(madm)
   );
   ```

2. ğŸ“‘ Báº¢NG DANH Má»¤C (danhmuc)
   ```sql
   CREATE TABLE danhmuc (
       madm INT PRIMARY KEY AUTO_INCREMENT,
       tendm VARCHAR(255) NOT NULL,
       soluongsp INT DEFAULT 0,
       thutu INT DEFAULT 0
   );
   ```

3. ğŸ‘¥ Báº¢NG TÃ€I KHOáº¢N (taikhoan)
   ```sql
   CREATE TABLE taikhoan (
       makh INT PRIMARY KEY AUTO_INCREMENT,
       hoten VARCHAR(255) NOT NULL,
       email VARCHAR(255) UNIQUE NOT NULL,
       matkhau VARCHAR(255) NOT NULL,
       diachi TEXT,
       sdt VARCHAR(20),
       anh VARCHAR(255),
       quyen ENUM('user', 'admin') DEFAULT 'user'
   );
   ```

4. ğŸ§¾ Báº¢NG HÃ“A ÄÆ N (hoadon)
   ```sql
   CREATE TABLE hoadon (
       mahd INT PRIMARY KEY AUTO_INCREMENT,
       makh INT NOT NULL,
       ngaydathang DATETIME NOT NULL,
       tongtien DECIMAL(10,3) DEFAULT 0,
       ghichu TEXT,
       trangthai ENUM('gio-hang', 'cho-xac-nhan', 'chuan-bi-don-hang', 
                     'dang-giao-hang', 'da-giao', 'da-huy') DEFAULT 'gio-hang',
       FOREIGN KEY (makh) REFERENCES taikhoan(makh)
   );
   ```

5. ğŸ“‹ Báº¢NG CHI TIáº¾T HÃ“A ÄÆ N (chitiethoadon)
   ```sql
   CREATE TABLE chitiethoadon (
       mahd INT NOT NULL,
       masp INT NOT NULL,
       soluong INT NOT NULL DEFAULT 1,
       dongia DECIMAL(10,3) DEFAULT 0,
       PRIMARY KEY (mahd, masp),
       FOREIGN KEY (mahd) REFERENCES hoadon(mahd),
       FOREIGN KEY (masp) REFERENCES sanpham(masp)
   );
   ```

6. ğŸ’¬ Báº¢NG BÃŒNH LUáº¬N (binhluan)
   ```sql
   CREATE TABLE binhluan (
       mabl INT PRIMARY KEY AUTO_INCREMENT,
       noidung TEXT NOT NULL,
       makh INT NOT NULL,
       masp INT NOT NULL,
       ngaybl DATETIME DEFAULT CURRENT_TIMESTAMP,
       FOREIGN KEY (makh) REFERENCES taikhoan(makh),
       FOREIGN KEY (masp) REFERENCES sanpham(masp)
   );
   ```

7. ğŸ“Š Báº¢NG LOG THAY Äá»”I KHO (stock_log) - âœ¨ NEW FEATURE
   ```sql
   CREATE TABLE stock_log (
       id INT PRIMARY KEY AUTO_INCREMENT,
       masp INT NOT NULL,
       quantity_change INT NOT NULL,
       reason VARCHAR(255),
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       FOREIGN KEY (masp) REFERENCES sanpham(masp)
   );
   ```

================================================================

âœ¨ TÃNH NÄ‚NG Ná»”I Báº¬T
====================

1. ğŸ›’ Há»† THá»NG GIá» HÃ€NG NÃ‚NG CAO
   - Session-based cart cho user chÆ°a Ä‘Äƒng nháº­p
   - Database cart cho user Ä‘Ã£ Ä‘Äƒng nháº­p
   - AJAX thÃªm/xÃ³a sáº£n pháº©m khÃ´ng reload trang
   - Cáº­p nháº­t sá»‘ lÆ°á»£ng real-time
   - TÃ­nh tá»•ng tiá»n tá»± Ä‘á»™ng

2. ğŸ“¦ QUáº¢N LÃ KHO Tá»° Äá»˜NG
   - Tracking sá»‘ lÆ°á»£ng tá»“n kho
   - Tá»± Ä‘á»™ng trá»« kho khi duyá»‡t Ä‘Æ¡n hÃ ng
   - Cáº£nh bÃ¡o sáº£n pháº©m sáº¯p háº¿t hÃ ng
   - Log lá»‹ch sá»­ thay Ä‘á»•i sá»‘ lÆ°á»£ng
   - Transaction safety Ä‘áº£m báº£o data integrity

3. ğŸ” Báº¢O Máº¬T TOÃ€N DIá»†N
   - PDO Prepared Statements chá»‘ng SQL Injection
   - Session-based authentication
   - Role-based access control (user/admin)
   - Input validation vÃ  sanitization
   - File upload security

4. ğŸ“± RESPONSIVE DESIGN
   - Mobile-first approach
   - CSS Grid & Flexbox layout
   - Adaptive navigation
   - Touch-friendly interface

5. ğŸ¨ ADMIN DASHBOARD HIá»†N Äáº I
   - Real-time statistics
   - Inventory alerts
   - Order management
   - User management
   - Product analytics

================================================================

ğŸš€ FLOW Xá»¬ LÃ CHÃNH
====================

1. ğŸ›ï¸ QUY TRÃŒNH MUA HÃ€NG:
   ```
   User Browser â†’ Browse Products â†’ Add to Cart â†’ 
   Login/Register â†’ Checkout â†’ Order Confirmation â†’ 
   Admin Review â†’ Order Processing â†’ Delivery â†’ Complete
   ```

2. ğŸ“¦ QUY TRÃŒNH QUáº¢N LÃ KHO:
   ```
   Admin Add Product â†’ Set Initial Stock â†’ 
   Customer Order â†’ Admin Approve â†’ Auto Reduce Stock â†’ 
   Low Stock Alert â†’ Restock â†’ Update Inventory
   ```

3. ğŸ” QUY TRÃŒNH AUTHENTICATION:
   ```
   User Access â†’ Check Session â†’ 
   If Not Logged: Redirect to Login â†’ 
   Validate Credentials â†’ Set Session â†’ 
   Role-based Redirect (Admin/User Dashboard)
   ```

================================================================

ğŸ’» TECHNOLOGIES STACK
======================

ğŸ”§ Backend:
- PHP 7.4+ (Server-side scripting)
- MySQL 5.7+ (Database)
- PDO (Database abstraction)
- Session Management (User state)

ğŸ¨ Frontend:
- HTML5 (Structure)
- CSS3 (Styling + Grid/Flexbox)
- JavaScript (Interactivity)
- AJAX (Asynchronous requests)

ğŸ› ï¸ Development Tools:
- VS Code (IDE)
- XAMPP (Local server)
- phpMyAdmin (Database management)
- Git (Version control)

ğŸ”’ Security:
- Prepared Statements (SQL Injection prevention)
- Input Validation (XSS prevention)
- Session Security (Authentication)
- File Upload Validation

================================================================

ğŸ“Š THá»NG KÃŠ Dá»° ÃN
==================

ğŸ“„ Sá»‘ lÆ°á»£ng files:
- Controllers: 4 files
- Models: 7 files  
- Views: 25+ files
- CSS: 8 files
- Images: 50+ files

ğŸ’¾ Database:
- 7 báº£ng chÃ­nh
- Quan há»‡ FOREIGN KEY Ä‘áº§y Ä‘á»§
- Indexes cho performance
- Transaction support

ğŸ”§ Functions:
- 50+ PHP functions
- CRUD operations hoÃ n chá»‰nh
- Security functions
- Helper utilities

================================================================

ğŸ¯ DEMO SCENARIOS
=================

1. ğŸ‘¤ USER JOURNEY:
   ```
   1. Truy cáº­p trang chá»§
   2. Duyá»‡t sáº£n pháº©m theo danh má»¥c
   3. Xem chi tiáº¿t sáº£n pháº©m
   4. ThÃªm vÃ o giá» hÃ ng
   5. ÄÄƒng kÃ½/Ä‘Äƒng nháº­p
   6. Thanh toÃ¡n Ä‘Æ¡n hÃ ng
   7. Theo dÃµi tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
   ```

2. ğŸ›ï¸ ADMIN WORKFLOW:
   ```
   1. ÄÄƒng nháº­p admin
   2. Xem dashboard thá»‘ng kÃª
   3. Quáº£n lÃ½ sáº£n pháº©m (CRUD)
   4. Quáº£n lÃ½ danh má»¥c
   5. Xá»­ lÃ½ Ä‘Æ¡n hÃ ng
   6. Quáº£n lÃ½ user
   7. Xem bÃ¡o cÃ¡o kho
   ```

3. ğŸ“¦ INVENTORY MANAGEMENT:
   ```
   1. ThÃªm sáº£n pháº©m vá»›i sá»‘ lÆ°á»£ng
   2. KhÃ¡ch Ä‘áº·t hÃ ng
   3. Admin duyá»‡t Ä‘Æ¡n â†’ Tá»± Ä‘á»™ng trá»« kho
   4. Cáº£nh bÃ¡o khi sáº¯p háº¿t hÃ ng
   5. Nháº­p thÃªm hÃ ng
   6. Xem lá»‹ch sá»­ thay Ä‘á»•i
   ```

================================================================

ğŸª LIVE DEMO CODE SNIPPETS
===========================

1. ğŸ” SEARCH FUNCTIONALITY:
   ```javascript
   // Real-time search
   function searchProducts() {
       const keyword = document.getElementById('search').value;
       
       if(keyword.length > 2) {
           fetch(`?mod=product&act=search&keyword=${keyword}`)
           .then(response => response.json())
           .then(data => {
               displaySearchResults(data);
           });
       }
   }
   ```

2. ğŸ›’ AJAX ADD TO CART:
   ```javascript
   function addToCart(masp) {
       fetch('?mod=product&act=addToCart', {
           method: 'POST',
           headers: {'Content-Type': 'application/x-www-form-urlencoded'},
           body: `masp=${masp}`
       })
       .then(response => response.json())
       .then(data => {
           if(data.status === 'success') {
               updateCartCounter();
               showSuccessMessage('ÄÃ£ thÃªm vÃ o giá» hÃ ng!');
           }
       });
   }
   ```

3. ğŸ“Š DYNAMIC DASHBOARD:
   ```php
   // Real-time statistics
   $today_orders = count(pdo_query(
       "SELECT * FROM hoadon WHERE DATE(ngaydathang) = CURDATE()"
   ));
   
   $low_stock_products = pdo_query(
       "SELECT * FROM sanpham WHERE soluong <= 10"
   );
   
   $monthly_revenue = pdo_query_one(
       "SELECT SUM(tongtien) as total FROM hoadon 
        WHERE MONTH(ngaydathang) = MONTH(CURRENT_DATE())
        AND trangthai = 'da-giao'"
   );
   ```

================================================================

ğŸ† Káº¾T LUáº¬N VÃ€ ÄÃNH GIA
========================

âœ… ÄIá»‚M Máº NH:
- Kiáº¿n trÃºc MVC rÃµ rÃ ng, dá»… maintain
- Security tá»‘t vá»›i PDO vÃ  prepared statements  
- Inventory management tá»± Ä‘á»™ng vÃ  chÃ­nh xÃ¡c
- Responsive design thÃ¢n thiá»‡n mobile
- Admin dashboard Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng
- Code clean, cÃ³ documentation

ğŸ”„ Cáº¢I TIáº¾N TRONG TÆ¯Æ NG LAI:
- TÃ­ch há»£p payment gateway
- Há»‡ thá»‘ng notification real-time
- API RESTful cho mobile app
- Advanced analytics vÃ  reporting
- Multi-language support
- Advanced search vá»›i filters

ğŸ’¡ BÃ€I Há»ŒC:
- Importance cá»§a planning vÃ  architecture
- Security best practices
- User experience design
- Database optimization
- Testing vÃ  debugging procedures

================================================================

ğŸ“ THÃ”NG TIN LIÃŠN Há»†
====================

ğŸ‘¨â€ğŸ’» Developer: tutaki304
ğŸ¯ Project: ShopTuPHP E-commerce System
ğŸ“… Completion Date: August 2025
ğŸ”§ Tech Stack: PHP, MySQL, HTML5, CSS3, JavaScript
ğŸ“‹ Purpose: Academic Project & Portfolio

================================================================
                            Káº¾T THÃšC BÃO CÃO
================================================================
